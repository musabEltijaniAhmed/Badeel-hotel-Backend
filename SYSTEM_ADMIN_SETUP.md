# 🔧 إعداد المدير الثابت للنظام

## 📋 نظرة عامة

يتم إنشاء حساب مدير ثابت تلقائياً عند تثبيت النظام لضمان وجود وصول إداري دائم. هذا المدير يملك جميع الصلاحيات الإدارية في النظام.

## 🚀 التثبيت التلقائي

### عند تشغيل الإعداد الكامل:
```bash
npm run setup:complete
```

هذا الأمر يقوم بـ:
1. إعداد قاعدة البيانات
2. إنشاء الأدوار والصلاحيات
3. **إنشاء المدير الثابت تلقائياً**
4. تحديث مجموعة Postman

### لإنشاء المدير فقط:
```bash
npm run create:admin
```

## 🔐 بيانات تسجيل الدخول الافتراضية

### القيم الافتراضية:
```
📱 رقم الهاتف: +966500000000
📧 الإيميل: admin@booking-system.com
🔑 كلمة المرور: Admin@123456
👤 الاسم: System Administrator
🎭 الدور: مدير النظام (Admin)
```

## ⚙️ تخصيص بيانات المدير

يمكنك تخصيص بيانات المدير عبر متغيرات البيئة في ملف `.env`:

```bash
# System Admin Configuration
SYSTEM_ADMIN_NAME=اسم المدير المخصص
SYSTEM_ADMIN_PHONE=+966501234567
SYSTEM_ADMIN_EMAIL=my-admin@mycompany.com
SYSTEM_ADMIN_PASSWORD=MySecurePassword123!
```

## 🔒 ميزات الأمان

### 1. تشفير كلمة المرور:
- يتم تشفير كلمة المرور باستخدام bcrypt مع 12 جولة
- لا يتم حفظ كلمة المرور في شكل نص خام

### 2. فحص المدير الموجود:
- إذا كان المدير موجوداً، لا يتم إنشاء مدير جديد
- يتم تحديث كلمة المرور إذا كانت غير مشفرة

### 3. معلومات التحقق:
- يعرض النظام معلومات المدير الموجود
- يتأكد من صحة الدور والصلاحيات

## 📱 كيفية تسجيل الدخول

### 1. استخدام رقم الهاتف:
```bash
POST /auth/login
Content-Type: application/json

{
  "phone": "+966500000000",
  "password": "Admin@123456"
}
```

### 2. الاستجابة المتوقعة:
```json
{
  "success": true,
  "message": "Login success",
  "data": {
    "user": {
      "id": "admin-uuid",
      "name": "System Administrator",
      "phone": "+966500000000",
      "email": "admin@booking-system.com",
      "roleId": 2,
      "Role": {
        "name": "admin",
        "description": "System Administrator"
      }
    },
    "token": "jwt-token-here"
  }
}
```

## 🎯 صلاحيات المدير الثابت

المدير الثابت يملك جميع الصلاحيات التالية:

### 👥 إدارة المستخدمين:
- عرض جميع المستخدمين
- إنشاء وتعديل وحذف المستخدمين
- تغيير أدوار المستخدمين
- تعطيل/تفعيل الحسابات

### 🏢 إدارة العقارات:
- عرض جميع العقارات
- الموافقة على العقارات الجديدة
- تعديل وحذف العقارات
- إدارة أنواع العقارات

### 📅 إدارة الحجوزات:
- عرض جميع الحجوزات
- تحديث حالة الحجوزات
- معالجة المبالغ المستردة
- إلغاء الحجوزات

### 🎫 إدارة الكوبونات:
- إنشاء وتعديل الكوبونات
- عرض إحصائيات الاستخدام
- تفعيل/تعطيل الكوبونات

### ⭐ إدارة التقييمات:
- مراجعة التقييمات
- الموافقة/رفض التقييمات
- حذف التقييمات غير المناسبة

### 📊 التقارير والإحصائيات:
- عرض لوحة التحكم الإدارية
- تصدير التقارير
- مراقبة أداء النظام

## ⚠️ تحذيرات أمنية

### 🔴 مهم جداً:
1. **غيّر كلمة المرور فوراً** بعد أول تسجيل دخول
2. **لا تشارك بيانات تسجيل الدخول** مع أي شخص غير مخول
3. **استخدم كلمة مرور قوية** تحتوي على أرقام ورموز وأحرف كبيرة وصغيرة
4. **فعّل المصادقة الثنائية** إن أمكن (مخطط للتطوير المستقبلي)

### 🛡️ أفضل الممارسات:
- استخدم متغيرات البيئة لحفظ بيانات المدير
- لا تحفظ كلمة المرور في الكود
- قم بعمل نسخ احتياطية دورية من قاعدة البيانات
- راقب نشاط تسجيل الدخول بانتظام

## 🔄 إعادة تعيين المدير

إذا فقدت الوصول للمدير، يمكنك إعادة إنشاؤه:

### 1. حذف المدير الحالي من قاعدة البيانات:
```sql
DELETE FROM Users WHERE phone = '+966500000000';
```

### 2. إعادة تشغيل أمر الإنشاء:
```bash
npm run create:admin
```

## 📞 الدعم الفني

إذا واجهت مشاكل في إنشاء أو الوصول للمدير الثابت:

1. تأكد من صحة متغيرات قاعدة البيانات
2. تحقق من وجود جدول Roles وأن role_id=2 موجود
3. راجع ملفات السجل للأخطاء
4. تأكد من تثبيت bcrypt بشكل صحيح

## 🔄 تحديث المدير

لتحديث بيانات المدير الثابت:

### 1. تحديث ملف البيئة:
```bash
SYSTEM_ADMIN_NAME=اسم جديد
SYSTEM_ADMIN_EMAIL=email-جديد@company.com
```

### 2. إعادة تشغيل الأمر:
```bash
npm run create:admin
```

النظام سيكتشف المدير الموجود ويحدث البيانات المطلوبة فقط.

---

## 📋 ملخص الأوامر

| الأمر | الوصف |
|-------|--------|
| `npm run create:admin` | إنشاء المدير الثابت فقط |
| `npm run setup:complete` | الإعداد الكامل مع المدير |
| `npm run db:reset` | إعادة تعيين قاعدة البيانات (يحذف المدير) |

**ملاحظة:** استخدم هذه الأوامر بحذر في بيئة الإنتاج!
